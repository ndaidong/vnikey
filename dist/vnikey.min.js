// vnikey@0.3.0, by @ndaidong - built on Sun, 28 Jun 2020 14:22:04 GMT - published under MIT license
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).vnikey={})}(this,(function(e){const t=e=>"BODY"!==e.nodeName&&e.isContentEditable,n=e=>"BODY"===e.nodeName&&e.parentNode&&e.parentNode.parentNode&&"on"===e.parentNode.parentNode.designMode,o=e=>(e=>{const t=e.getAttribute("type")||"text";return"INPUT"===e.nodeName&&("text"===t||"search"===t)})(e)||(e=>"TEXTAREA"===e.nodeName)(e)||n(e)||t(e),r=e=>e.map(e=>[[...e],[...e.map(e=>e.toUpperCase())]]).reduce((e,t)=>[...e,...t],[]),i="bcdđhgklmnpqrstvx",s=[i,i.toUpperCase()].join(""),c=["aăâeêioôơuưy","áắấéếíóốớúứý","àằầèềìòồờùừỳ","ảẳẩẻểỉỏổởủửỷ","ãẵẫẽễĩõỗỡũữỹ","ạặậẹệịọộợụựỵ"],a=[...c].map(e=>e+e.toUpperCase()).map(e=>e.split("")).reduce((e,t)=>[...e,...t],[]).join(""),u=[...c].map(e=>[e[1],e[2],e[4],e[7],e[8],e[10]]).reduce((e,t)=>[...e,...t],[]).join(""),l=[...c].slice(1).join(""),f=["ab,ace,act,ad,ae,ann,al,ag,ar,as","bb,br,bl","cc,ck,cl,cr,cs,ct","dr","ed,eg,el,er,es,ex","f","gl,gm,gn,gr","ig,il,ir","j","kn,kr","nc,nd,nk,np,nt,ns","ocu,od,ol,oo,or","pl,pr","rd,rs,rt","sp,st","tb,tc,tt","ub,ul","w","z"].join(","),d=[f,f.toUpperCase()].join(",").split(","),p={d:"đ",D:"Đ"},m=[...c].map(e=>[[e[0],e[1]],[e[2],e[1]],[e[0].toUpperCase(),e[1].toUpperCase()],[e[2].toUpperCase(),e[1].toUpperCase()]]).reduce((e,t)=>[...e,...t],[]),g=r([["uo","ươ"],["uô","ươ"],["uó","ướ"],["uố","ướ"],["uò","ườ"],["uồ","ườ"],["uỏ","ưở"],["uổ","ưở"],["uõ","ưỡ"],["uỗ","ưỡ"],["uọ","ượ"],["uộ","ượ"]].concat([...c].map(e=>[[e[6],e[8]],[e[7],e[8]],[e[9],e[10]]]).reduce((e,t)=>[...e,...t],[]))),j=r([["uo","uô"],["ươ","uô"],["uó","uố"],["ướ","uố"],["uò","uồ"],["ườ","uồ"],["uỏ","uổ"],["ưở","uổ"],["uõ","uỗ"],["ưỡ","uỗ"],["uọ","uộ"],["ượ","uộ"]].concat([...c].map(e=>[[e[0],e[2]],[e[1],e[2]],[e[3],e[4]],[e[6],e[7]],[e[8],e[7]]]).reduce((e,t)=>[...e,...t],[]))),b=(h=[...c].map(e=>e.split("")),Object.keys(h[0]).map(e=>h.map(t=>t[e])));var h;const k={1:r([...b].map(e=>[[...e.slice(0,1),...e.slice(2)].join(""),e[1]])),2:r([...b].map(e=>[[...e.slice(0,2),...e.slice(3)].join(""),e[2]])),3:r([...b].map(e=>[[...e.slice(0,3),...e.slice(4)].join(""),e[3]])),4:r([...b].map(e=>[[...e.slice(0,4),...e.slice(5)].join(""),e[4]])),5:r([...b].map(e=>[[...e.slice(0,5)].join(""),e[5]]))},y=e=>e&&-1!==a.indexOf(e),v=e=>e&&-1!==u.indexOf(e),N=e=>e&&-1!==l.indexOf(e),C=e=>{return(t=e)&&-1!==s.indexOf(t)||y(e);var t},O=(e,t)=>{const n=k[t];for(const t of n)if(t[0].includes(e))return t[1];return e},x=(e,t,n)=>{const{count:o,mark:r,endWithVowel:i}=((e=[])=>{const t={count:0,mark:0};for(const n of e)y(n)&&t.count++,v(n)&&t.mark++;const n=e[e.length-1];return t.endWithVowel=a.indexOf(n)>=0,t})(t),s=Math.min(n,t.length);if(r>0)for(let n=s-1;n>=0;n--){const o=t[n];if(v(o)){const r=t[n+1];if(N(r))break;const i=O(o,e);if(i!=o)return t[n]=i,t.join("")}}else if(1===o)for(let n=s-1;n>=0;n--){const o=t[n];if(y(o)){const r=O(o,e);if(r!=o)return t[n]=r,t.join("")}}else if(2===o){const n=t.join("");if(!i||n.startsWith("qu")||n.startsWith("gi"))for(let n=s-1;n>=0;n--){const o=t[n];if(y(o)){const r=t[n+1];if(N(r))break;const i=O(o,e);if(i!=o)return t[n]=i,t.join("")}}else for(let n=0;n<s;n++){const o=t[n];if(y(o)){const r=t[n-1];if(N(r))break;const i=O(o,e);if(i!=o)return t[n]=i,t.join("")}}}else if(3===o){let n=!1;for(let o=s-1;o>=0;o--){const r=t[o];if(y(r)){if(!n){n=!0;continue}const i=O(r,e);if(i!=r)return t[o]=i,t.join("")}}}return t.splice(n,0,e),t.join("")},E=(e,t,n)=>{const o=t.split("");if(0===n||t.length>7||(e=>d.some(t=>e.search(t)>-1))(t))o.splice(n,0,e);else{if(9===e)return((e,t,n)=>(t[0]in p?t[0]=p[t[0]]:t[n-1]in p?t[n-1]=p[t[n-1]]:t.splice(n,0,e),t.join("")))(e,o,n);if([8,7,6].includes(e))return((e,t,n)=>{if(8===e)for(const e of m){const o=e[0],r=e[1];for(let e=n-1;e>=0;e--){if(t[e]===o)return t[e]=r,t.join("")}}else if(7===e)for(const e of g){const o=e[0],r=e[1];if(2===o.length){const e=t.join("");if(e.search(o)>-1)return e.replace(o,r)}else for(let e=n-1;e>=0;e--){if(t[e]===o)return t[e]=r,t.join("")}}else if(6===e)for(const e of j){const o=e[0],r=e[1];if(2===o.length){const e=t.join("");if(e.search(o)>-1)return e.replace(o,r)}else for(let e=n-1;e>=0;e--){if(t[e]===o)return t[e]=r,t.join("")}}return t.splice(n,0,e),t.join("")})(e,o,n);if([5,4,3,2,1].includes(e))return x(e,o,n)}return o.join("")},w=(e,t,n)=>{const o=t.substring(0,n),r=t.substring(n);let i=o.length;for(let e=i;e>=0;e--){const t=o[e];if(t&&!C(t))break;i=e}let s=0;for(let e=s;e<r.length;e++){const t=r[e];if(t&&!C(t))break;s=e+1}const c=n-i;s+=n;const a=[o,r].join(""),u=a.substr(0,i),l=a.substr(s,a.length),f=a.substring(i,s),d=E(e,f,c);return{replacement:[u,...d,l].join(""),curpos:n+d.length-f.length}},U=e=>(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1),D=(e,n)=>{const o=(e=>{const n=e.target,o=t(n)?window.getSelection():(()=>{const e=n.parentNode.parentNode;return(e.defaultView||e.parentWindow).getSelection()})();return o&&o.rangeCount>0?o:null})(e);if(!o)return!1;const r=o.getRangeAt(0),i=r.startOffset;if(i!=r.endOffset)return!1;const s=r.startContainer,{replacement:c,curpos:a}=w(n,s.data,i);return((e,t,n,o,r)=>{const i=o.data;o.deleteData(0,i.length),o.insertData(0,t),r.setStart(o,n),U(e)})(e,c,a,s,r)},A=(e,o)=>{if(o<49||o>57)return!1;const r=o-48,i=e.target;if(n(i)||t(i))return D(e,r);const s="selectionStart"in(c=e.target)&&document.activeElement===c?c.selectionStart:-1;var c;if(-1===s)return!1;const{replacement:a,curpos:u}=w(r,i.value,s);return((e,t,n)=>{const o=e.target;o.value=t,o.focus(),o.selectionEnd=n,U(e)})(e,a,u)},M=e=>{const t=e.target,n=e.which||e.keyCode;return!!o(t)&&A(e,n)},S=(e,t,n)=>e.addEventListener(t,n,!1),W=()=>{S(document,"keypress",M);const e=e=>{const t=e.contentWindow.document;return S(t,"keypress",M),e};Array.from(document.getElementsByTagName("iframe")).filter(e=>""===e.src).map(e);new MutationObserver(t=>{for(const n of t)Array.from(n.addedNodes).filter(e=>"IFRAME"===e.tagName).map(e)}).observe(document.body,{attributes:!1,childList:!0,subtree:!0})},T=()=>"loading"!==document.readyState?setTimeout(W,0):document.addEventListener("DOMContentLoaded",W);T(),e.findReplacer=w,e.init=T,e.isContentEditable=t,e.isIframeEditor=n,e.isInterested=o,Object.defineProperty(e,"__esModule",{value:!0})}));